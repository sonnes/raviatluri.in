---
  author: 'You'
  date: '2023-08-24'
  title: 'Building xdb'
  description: xdb is a new type of data toolkit that simplifies application development and database operations.
  tags: ['xdb']
---

xdb is a Go SDK that combines multiple storage engines with a single abstraction and schema. xdb provides a simple consistent API to ingest and query data.

# Inspiration

The idea of xdb originated while implementing an ingestion worker for Dgraph. Dgraph provides a N-Quad mutation API to insert or update data. The simplicity of the N-Quad format allowed implementation of a generic worker that could ingest any N-Quad. Adding new domain models was as simple as adding a domain-to-nquad mapping. There were no SQL migrations, no query changes, etc.

How can we borrow this simplicity and apply it all data ingestion and querying usecases?

Why worry about the underlying database management, build & maintain SQL queries, etc.?

What if we build an abstraction that allows developers to:

- focus on just modeling their domain, ingesting data, and querying it?
- swap out the underlying database without any changes to queries?
- switch between row-oriented and column-oriented storage engines?
- combine capabilities of different databases to work around their individual limitations?
- use multiple types of databases - relational, graph, search, time-series, etc. in a single application?

# N-Quads

The N-Quad is a very simple, yet powerful, way to represent attributes and relationships of most domain models. Dgraph extended the N-Quad format to support additional metadata for relationships.

Here's a reduced example of Twitter in N-Quads:

```
<Tweet:1> <text> "Tweet 1 @user2 #news #xdb" .
<Tweet:1> <author> <User:1> .
<Tweet:1> <mentions> <User:2> .
<Tweet:1> <contains> <Hashtag:news> .
<Tweet:1> <contains> <Hashtag:xdb> .
<User:1> <follows> <User:2> (since="2009-11-10T23:00:00Z") .
<User:2> <follows> <User:5> (since="2010-12-10T23:00:00Z") .
<User:3> <follows> <Hashtag:news> .
```

# Data Model

xdb has a simple data model inspired by N-Quads.

## Record

A record is a logical entity containing attributes and edges. A record is uniquely identified by `ID`. Similar records are grouped by `Kind`.

A `Key` is the primary key of a record. A `Key` is a combination of `Kind` and `ID`.

The Subject of an N-Quad is a unique reference to a record.

## Attribute

Attributes have a `name` and a `value`. Attributes always belong to a record.

The Predicate of an N-Quad is the `name` of the attribute. The `value` is the Object.

## Value

xdb supports all Go primitive types as values. Values can be scalar types, arrays, or custom types.

## Edge

Edges represent directed relationships between records. Think of an edge as a attribute whose value is a `Key` of target record. Edges can have additional metadata to hold information about the relationship.

# Schema

xdb has a strict, yet easy to use, schema. A good mental model for the schema is to think of it as a intended shape of application domain, similar to defining a Terraform resource.

The schema acts as a intermediary between the application domain model and the underlying database(s).

An example of a schema for Twitter:

```yaml
schema:
  - kind: Tweet
    attributes:
      - name: text
        type: string
      - name: created_at
        type: time
    edges:
      - name: author
        type: User
      - name: mentions
        type: User
        array: true
      - name: contains
        type: Hashtag
        array: true
  - kind: User
    attributes:
      - name: name
        type: string
    edges:
      - name: follows
        type: User
        array: true
        metadata:
          - name: since
            type: time
```

# Developer Experience

Using xdb is as simple as defining a schema, initializing a store, and writing data.

For this example, we will use BadgerDB as the underlying storage engine.

```go
import (
  "context"
  "time"

  "github.com/xdb-dev/xdb"
  "github.com/xdb-dev/xdb/kv/badger"
)

func main() {
  schema, _ := schema.Load("schema.yaml")

  store, _ := badger.NewStore(
    badger.Dir("/tmp/xdb"),
    badger.Schema(schema),
  )

  tweet := xdb.NewKey("Tweet", "1")

  text := xdb.NewAttr(tweet, "text",
    xdb.String("Tweet 1 @user2 #news #xdb"),
  )
  createdAt := xdb.NewAttr(tweet, "created_at",
    xdb.Time(time.Now()),
  )

  _ = store.PutAttrs(context.Background(), text, createdAt)

  user1 := xdb.NewKey("User", "1")
  user2 := xdb.NewKey("User", "2")

  edges := []xdb.Edge{
    xdb.NewEdge(tweet, "author", user1),
    xdb.NewEdge(tweet, "mentions", user2),
  }

  _ = store.PutEdges(context.Background(), edges...)
}
```

The xdb repository is available at https://github.com/xdb-dev/xdb
